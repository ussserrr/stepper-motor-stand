# stepper-motor-stand
Драйвер управления шаговым двигателем через простые ключи для Arduino (МК ATmega328P) с управлением по USART (параметры 57600, 8N1). Для получения справки передайте команду `help` + ENTER. Может использоваться как стенд с попеременным движением то в одну, то в другую сторону (при использовании концевиков).


## Функциональность
  - 2 режима управления двигателем:
    - **wave** - обыкновенный режим попеременного последовательного включения обмоток,
    - **full-step** - обеспечивает повышенный крутящий момент (ток подается на две обмотки сразу);
  - Настройка длительности импульсов (влияет на скорость и крутящий момент);
  - Подключение двух "концевиков", по срабатыванию которых происходит смена направления вращения;
  - Сохранение параметров в энергонезависимой памяти EEPROM;
  - Встроенная справка по системе команд (команда `help`);
  - Функция поворота на заданное количество шагов для точного позиционирования (блокирующая и неблокирующая функции).


## Подключение
Шаговый двигатель с униполярным включением (4 провода) должен подключаться к Arduino через любые ключи (реле, дискретные транзисторы, сборки транзисторов Дарлингтона, микросхемы-драйверы и т.д.).
  - PC2, PC3, PC4, PC5: двигатель. Правильный порядок подключения фаз: A-C-B-D соответственно (при условии, что AB и CD - 2 обмотки двигателя);
  - PB2, PB3: концевики (кнопки, следует подтянуть к питанию);
  - Параметры обмена по последовательному интерфейсу: 57600 бод, 8N1, NL&CR.


## Сборка программы и прошивка
Для сборки рекомендуется использовать программу PlatformIO.

### Консольный режим
При необходимости настройте параметры прошивки в файле `platformio.ini` (например, укажите, использовать для прошивки программатор или нет). Затем, в папке с проектом выполните:
```bash
$ pio run  # компиляция

$ pio run -t program  # загрузка через программатор
или
$ pio run -t upload  # загрузка через встроенный программатор Arduino

$ pio run -t uploadeep  # загрузка в EEPROM значений по умолчанию
```

### IDE (Atom или VScode)
  - Импортируйте папку репозитория: `File` -> `Add Project Folder`;
  - При необходимости настройте параметры прошивки в файле `platformio.ini` (например, укажите, использовать для прошивки программатор или нет);
  - Запустите сборку `PlatformIO` -> `Build`;
  - Откройте встроенный терминал и выполните команду (при загрузке через программатор):
    ```bash
    $ pio run -t program; pio run -t uploadeep
    ```
    При загрузке через плату Arduino:
    ```sh
    $ pio run -t upload; pio run -t uploadeep
    ```


## Доступные команды
Данную справку также можно получить непосредственно от драйвера с помощью вызова команды `help`.
```
	pulse [значение]
		Установить длительность высокого уровня импульса в микросекундах (от 64 мкс до 16384 мкс, целое число). Значения типа '12345678' будут интерпретированы как '12345'

	fullstep
		Установить полношаговый режим управления

	wave
		Установить режим управления поочередного переключения фаз

    move/movenb [±steps]
        Сделать [±steps] шагов в блокирующем/неблокирующем режиме и остановиться (независимо от состояния до команды). Знак задает направление движения

    stop
        Остановить мотор

	info
		Получить информацию о текущих значениях регистров таймеров, режиме (full-step или wave) и направлении/отсутствии движения

	save
		Сохранить текущую конфигурацию в EEPROM
```
